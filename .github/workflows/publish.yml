on: 
  push:
    branches: [support/2.3]

jobs:
  build_current:
    name: Build v2.3
    if: github.ref == 'refs/heads/support/2.3'
    runs-on: ubuntu-latest
    container: python:3
    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683  #v4.2.2
      with:
        ref: 'support/2.3'
    - name: Install pre-requisites
      run: pip install -r requirements.txt
    - name: Build
      run: mkdocs build -v --clean
    - name: Schema
      run: generate-schema-doc schemas/spdx-schema.json site/spdx-json-schema.html
    - name: Upload
      uses: actions/upload-artifact@6f51ac03b9356f520e9adb1b1b7802705f340c2b  # v4.5.0
      with:
        name: site-v2.3
        path: ./site
  build_v2-draft:
    name: Build v2.3.1-draft
    if: github.ref == 'refs/heads/support/2.3.1'
    runs-on: ubuntu-latest
    container: python:3
    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683  #v4.2.2
      with:
        ref: 'support/2.3.1'
    - name: Install pre-requisites
      run: pip install -r requirements.txt
    - name: Build
      run: mkdocs build -v --clean
    - name: Schema
      run: generate-schema-doc schemas/spdx-schema.json site/spdx-json-schema.html
    - name: Upload
      uses: actions/upload-artifact@6f51ac03b9356f520e9adb1b1b7802705f340c2b  #v4.5.0
      with:
        name: site-v2.3.1-draft
        path: ./site
  publish:
    name: Publish
    runs-on: ubuntu-latest
    needs: [build_current, build_v2-draft]
    steps:
    - name: Download v2.3
      uses: actions/download-artifact@fa0a91b85d4f404e444e00e005971372dc801d16  #v4.1.8
      with:
        name: site-v2.3
        path: ./site/v2.3
    - name: Download v2.3.1-draft
      uses: actions/download-artifact@fa0a91b85d4f404e444e00e005971372dc801d16  #v4.1.8
      with:
        name: site-v2.3.1-draft
        path: ./site/v2.3.1-draft
    - name: Deploy
      uses: peaceiris/actions-gh-pages@4f9cc6602d3f66b9c108549d475ec49e8ef4d45e  #v4.0.0
      with:
        DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        PUBLISH_BRANCH: gh-pages
        PUBLISH_DIR: ./site
